(()=>{"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function t(e){return document.querySelector(`#${e.id}-error`)}function r(e,r,o){const n=t(r);n&&(r.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent="",n.removeAttribute("aria-live"))}function o(e,o,n){o.validity.valid?r(0,o,n):function(e,r,o,n){const a=t(r);a?(r.classList.add(n.inputErrorClass),a.textContent=o,a.classList.add(n.errorClass),a.setAttribute("aria-live","assertive")):console.error(`Error: No error element found for ${r.id}`)}(0,o,o.validationMessage,n)}function n(e,t){if(!e)return void console.error("Error: resetForm called with undefined formElement.");e.reset();const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((e=>r(0,e,t))),n?(n.classList.add(t.inactiveButtonClass),n.disabled=!0):console.error("Error: buttonElement not found during form reset.")}function a(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{(function(e,t){if(!e)return void console.error("Error: formElement is undefined, cannot set event listeners.");const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r.forEach((e=>{e.addEventListener("input",function(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];clearTimeout(t),t=setTimeout((()=>e(...n)),r)}}((()=>{o(0,e,t),function(e,t,r){const o=e.some((e=>!e.validity.valid));t?(t.classList.toggle(r.inactiveButtonClass,o),t.disabled=o):console.error("Error: buttonElement is undefined, cannot toggle button state.")}(r,n,t)})))}))})(t,e),t.addEventListener("submit",(r=>{r.preventDefault(),function(e,t){e?Array.from(e.querySelectorAll(t.inputSelector)).forEach((e=>o(0,e,t))):console.error("Error: displayErrorsOnSubmit called with undefined formElement.")}(t,e),t.checkValidity()&&console.log("Form submitted successfully!")}))}))}const s=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}_checkResponse(e){return e.ok?e.json():e.json().then((t=>{throw new Error(`Error ${e.status}: ${t.message||e.statusText}`)}))}_handleError(e){return console.error("API Request Failed:",e),Promise.reject(e)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse).catch(this._handleError)}updateUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then(this._checkResponse).catch((e=>console.error("Error updating profile:",e)))}updateProfileAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse).then((()=>this.getUserInfo())).catch(console.error)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse).catch(this._handleError)}addNewCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then(this._checkResponse).catch((e=>console.error("Error adding new card:",e)))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse).catch((e=>console.error("Error deleting card:",e)))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse).catch((e=>console.error("Error liking card:",e)))}unlikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse).catch((e=>console.error("Error unliking card:",e)))}getAppData(){return Promise.all([this.getUserInfo(),this.getInitialCards()]).then((e=>{let[t,r]=e;return t&&"Placeholder name"!==t.name||console.warn("Warning: API is returning placeholder data!"),{userData:t,cards:r}})).catch(this._handleError)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"402df489-8b33-4cc5-a119-272d843e9751","Content-Type":"application/json"}});s.getInitialCards().then((e=>{console.log(e)})),document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelector(".profile__name-first"),r=document.querySelector(".profile__description-first"),o=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__avatar-edit"),l=document.querySelector("#profile-name-input"),i=document.querySelector("#profile-description-input"),d=document.querySelector(".profile__edit-btn"),u=document.querySelector("#edit-modal"),m=document.forms["profile-form"],h=document.querySelector("#edit-avatar-modal"),f=document.forms["edit-avatar-form"],_=document.querySelector("#avatar-url-input"),p=document.querySelector(".cards__list"),v=document.querySelector("#card-template").content,y=document.querySelector("#add-card-modal"),E=document.forms["add-card-form"],b=document.querySelector("#card-image-url-input"),S=document.querySelector("#profile-caption-input"),g=document.querySelector(".profile__add-btn"),C=document.querySelector("#delete-card-modal"),k=document.querySelector("#confirm-delete-btn"),q=document.querySelectorAll(".modal__close-btn"),L=document.querySelector(".modal__close-btn-delete"),A=document.querySelector(".modal__cancel-delete"),U=document.querySelector("#preview-modal"),$=U?.querySelector(".modal__image_preview"),w=U?.querySelector(".modal__caption");let x=null;function I(e){e&&(e.classList.add("modal_opened"),document.addEventListener("keydown",R))}function P(e){e&&(e.classList.remove("modal_opened"),document.removeEventListener("keydown",R))}function R(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&P(e)}}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";if(!e.name||!e.link)return;const r=function(e){const t=v.cloneNode(!0).firstElementChild,r=t.querySelector(".card__title"),o=t.querySelector(".card__img"),n=t.querySelector(".card__delete-button"),a=t.querySelector(".card__like-button");return r.textContent=e.name,o.src=e.link,o.alt=e.name,n.addEventListener("click",(()=>function(e){C?(x=e,I(C)):console.error("Delete modal not found!")}(t))),a.addEventListener("click",(e=>e.target.classList.toggle("liked"))),o.addEventListener("click",(()=>{U&&$&&w&&($.src=e.link,$.alt=e.name,w.textContent=e.name,I(U))})),t}(e);"prepend"===t?p.prepend(r):p.append(r)}q.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>P(t)))})),L&&L.addEventListener("click",(()=>{console.log("Close (X) button clicked in delete modal!"),P(C)})),A&&A.addEventListener("click",(()=>{console.log("Cancel button clicked in delete modal!"),P(C)})),s.getUserInfo().then((e=>{console.log("API Response:",e),t.textContent=e.name||"Bessie Coleman",r.textContent=e.about||"Civil Aviator",o.src=e.avatar.includes("placeholder")?"./images/avatar.jpg":e.avatar})).catch(console.error),s.getInitialCards().then((e=>{console.log("Loaded Cards:",e),function(e){e.forEach(D)}(e)})).catch(console.error),k&&k.addEventListener("click",(()=>{x&&s.removeCard(x.dataset.cardId).then((()=>{x.remove(),P(C)})).catch(console.error)})),d&&d.addEventListener("click",(()=>{n(m,e),l.value=t?.textContent.trim()||"",i.value=r?.textContent.trim()||"",I(u)})),m&&m.addEventListener("submit",(e=>{e.preventDefault();const o=m.querySelector(".modal__submit-btn"),n=o.textContent;o.textContent="Saving...",o.disabled=!0,s.updateUserInfo({name:l.value.trim(),about:i.value.trim()}).then((()=>{t&&l&&(t.textContent=l.value.trim()),r&&i&&(r.textContent=i.value.trim()),P(u)})).catch(console.error).finally((()=>{o.textContent=n,o.disabled=!1}))})),c&&c.addEventListener("click",(()=>{n(f,e),I(h)})),f&&f.addEventListener("submit",(e=>{e.preventDefault();const t=_?.value.trim();t&&(o&&(o.src=t),P(h))})),g&&g.addEventListener("click",(()=>I(y))),E&&E.addEventListener("submit",(e=>{e.preventDefault();const t={name:S?.value.trim(),link:b?.value.trim()};t.name&&t.link&&s.addNewCard(t).then((e=>{D(e),E.reset(),P(y)})).catch(console.error)})),a(e)}))})();
//# sourceMappingURL=main.js.map